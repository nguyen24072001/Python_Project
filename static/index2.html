<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEMO IOT</title>
  </head>
  <body>

    <form>
      <h1 id="h1">enter password here
        <input type="password" id="input">
      </h1>
    </form>
    <div id="button">
      <button onclick=submit()>submit</button>
    </div>
    <div id="pass"></div>

    <div id="video-feed">
    </div>

    <div id="action-button">
      <button onclick="performAction()">Perform Action</button>
      <button onclick="MainTab()">Main Tab</button>
      <form method="POST" action="/">
        <label for="name1">Name 1:</label>
        <input type="text" id="name1" name="name1" value="{{ names[0] }}"><br>

        <label for="name2">Name 2:</label>
        <input type="text" id="name2" name="name2" value="{{ names[1] }}"><br>

        <input type="submit" value="Save">
    </form>
    </div>
    <div id="message"></div>

    <script>
    let enrollCounter = 0;
      const submit = () => {
        const h1 = document.querySelector('#h1')
        const button = document.querySelector('#button')
        const matkhau = document.querySelector('#input')
        const value = matkhau.value
        const defautPassword = "ptit"

        if (value === defautPassword){
          h1.innerHTML = ''
          button.innerHTML = ''
          document.querySelector('#pass').innerHTML = '<video id="video" width="640" height="480" autoplay></video>'

          // create new button
          const videoFeed = document.querySelector('#video-feed')
          const newButton = document.createElement('button')
          newButton.textContent = 'ENROLL USER1'
          newButton.onclick = () => {
            const video = document.querySelector('#video');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            canvas.toBlob((blob) => {
              const formData = new FormData();
              formData.append('image', blob, 'photo.jpg');
              uploadImage(formData, '/upload_image');
            }, 'image/jpeg', 0.95);
          }
          videoFeed.appendChild(newButton);

          // create new button 2
          const newButton2 = document.createElement('button')
          newButton2.textContent = 'ENROLL USER2'
          newButton2.onclick = () => {
            const video = document.querySelector('#video');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            canvas.toBlob((blob) => {
              const formData = new FormData();
              formData.append('image', blob, 'photo.jpg');
              uploadImage(formData, '/upload_image2');
            }, 'image/jpeg', 0.95);
          }
          videoFeed.appendChild(newButton2);

          navigator.mediaDevices.getUserMedia({ video: true })
            .then((stream) => {
              const video = document.querySelector('#video')
              video.srcObject = stream
            })
            .catch((error) => {
              console.error(error)
            })
        } else {
          alert('Incorrect password')
        }
      }

      const performAction = () => {
        // code to perform action goes here
        alert('Action performed!')
      }

      const uploadImage = (imageData, url) => {
        fetch(url, {
          method: 'POST',
          body: imageData
        })
        .then((response) => {
          if (!response.ok) {
            throw new Error('Failed to upload image');
          }
          enrollCounter++;
          const message = document.querySelector('#message');
          message.textContent = `Enroll success ${enrollCounter}!`;
        })
        .catch((error) => {
          console.error(error);
          const message = document.querySelector('#message');
          message.textContent = 'Failed to upload image';
        });
      }
    </script>
  <script>
  function MainTab() {
  // Get the root URL (http://127.0.0.1:5000/)
  var rootURL = window.location.protocol + "//" + window.location.host + "/";
  // Reload the current tab
  location.reload();
  // Return to the root URL
  window.location.href = rootURL;
}
</script>
  </body>
</html>